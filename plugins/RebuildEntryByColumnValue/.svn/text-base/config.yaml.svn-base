name: RebuildEntryByColumnValue
id:   RebuildEntryByColumnValue
key:  rebuildentrybycolumnvalue
version: 0.1
author_link: http://alfasado.net/
author_name: Alfasado Inc.
description: Rebuild entry by entry's column value.
tags:
    function:
        RebuildEntryByColumnValue: >
                sub {
                        my ( $ctx, $args, $cond ) = @_;
                        my $app = MT->instance;
                        my $blog_id = $args->{ blog_id };
                        if (! $blog_id || $blog_id ne 'all' ) {
                            $blog_id = $app->blog->id;
                        }
                        my $column = $args->{ column } || 'title';
                        my $class = $args->{ class } || 'entry';
                        my $eq = $args->{ eq };
                        return '' unless $eq;
                        require MT::Entry;
                        my $params;
                        $params->{ blog_id } = $blog_id if $blog_id;
                        $params->{ class } = $class;
                        $params->{ $column } = $eq;
                        $params->{ status } = MT::Entry::RELEASE();
                        my @entries = MT::Entry->load( $params );
                        require MT::WeblogPublisher;
                        my $pub = MT::WeblogPublisher->new;
                        for my $entry ( @entries ) {
                            $pub->rebuild_entry( Blog => $entry->blog, Entry => $entry->id );
                        }
                        return '';
                    }

